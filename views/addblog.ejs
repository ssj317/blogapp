<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head') %>
    <title>BLOG PAGE</title>
    <style>
      .comment-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: 20px;
      }

      .comment-container img {
        border-radius: 50%;
        width: 50px;
        height: 50px;
      }

      .comment-content {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        margin-left: 60px;
        max-width: 600px;
        word-wrap: break-word;
      }

      .comment-actions {
        margin-left: auto;
      }
    </style>
  </head>
  <body>
    <%- include('./partials/nav') %>

    <div class="container mt-4">
        <h1><%= newblog.title %></h1>

        <img src="/upload/<%= newblog.coverimage.replace('uploads/', '') %>" style="width:700px;" alt="">
        <pre class="mt-3" style="max-width: 100%; max-height: 300px; overflow: auto; white-space: pre-wrap; word-wrap: break-word;">
          <%= newblog.body %>
        </pre>
    </div>

    <!-- Blog Creator Details -->
    <div class="comment-container mt-4">
        <img src="/<%= newblog.createdBy.profileImageURL || 'default-avatar.png' %>" alt="Profile Picture">
        <strong><%= newblog.createdBy.fullName %></strong>
    </div>

    <!-- Comments Section -->
    <div class="container mt-4">
      <h1>Comments (<%= comments.length %>)</h1>
      <hr>

      <!-- Comment Form -->
      <form action="/user/comment/<%= newblog._id %>" method="post">
        <div class="mb-3">
          <label for="commentInput" class="form-label">Write Your Comment</label>
          <input type="text" class="form-control" id="commentInput" name="content">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>

    <div class="mt-2">
      <% comments.forEach(function(comment) { %>
        <div class="comment-container mt-4">
          <img src="/<%= comment.createdBy.profileImageURL || 'default-avatar.png' %>" alt="Profile Pic">
          <strong><%= comment.createdBy.fullName %>:</strong>
        </div>
        <div class="comment-content">
          <p><%= comment.content %></p>
          <% if (user && user.userid === comment.createdBy._id.toString()) { %>
            <div class="comment-actions">
              <a href="/user/edit/<%= comment._id %>" style="text-decoration: none; color: #007BFF;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">Edit</a>
            </div>
          <% } %>
        </div>
      <% }); %>
    </div>

    <%- include('./partials/scripts') %>
  </body>
</html>
